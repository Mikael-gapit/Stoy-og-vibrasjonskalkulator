<!DOCTYPE html>
<html lang="no">
<head>

<style>
  body { font-family: Arial, sans-serif; background: #f4f4f4; color: #222; }
  h2, h3 { color: #004077; }
  select, button { padding: 6px; font-size: 1rem; margin: 4px 0; }
  select { border-radius: 4px; border: 1px solid #aaa; }
  button { background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
  button:hover { background: #0056b3; }
  .eksponering-tabell { width: 100%; border-collapse: collapse; margin-top: 1rem; background: white; }
  .eksponering-tabell th, .eksponering-tabell td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  .eksponering-tabell th { background: #007bff; color: white; }
  .eksponering-tabell tr:nth-child(even) { background: #f0f8ff; }
  .eksponering-logg { background: #fff; border-left: 4px solid #007bff; padding: 1rem; margin-top: 2rem; }
</style>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bravida Vibrasjonsassistent</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 1rem; }
    .tool-img { max-height: 150px; margin-top: 1rem; }
    .eksponering-tabell td, .eksponering-tabell th { padding: 6px; border: 1px solid #ccc; text-align: center; }
    .Grønn { background-color: #d4edda; }
    .Gul { background-color: #fff3cd; }
    .Rød { background-color: #f8d7da; }
  </style>
</head>
<body>
  <img src="bravida logo-400x119.png" alt="Bravida logo" style="max-width: 200px;"/>
  <h1>Vibrasjonsassistent</h1>

  
  
  <label for="brandFilter">Filtrer etter merke:</label>
  <select id="brandFilter">
    <option value="alle" selected>Alle merker</option>
  </select>

  <label for="categoryFilter">Filtrer etter kategori:</label>
  <select id="categoryFilter">
    <option value="alle" selected>Alle kategorier</option>
  </select>

  <label for="toolSelect">Velg verktøy:</label>
  <select id="toolSelect">
    <option disabled selected>-- Velg et verktøy --</option>
  </select>

  <div id="toolInfo"></div>

  <script>
    async function loadTools() {
      const response = await fetch('./data.json');
      const data = await response.json();
      const select = document.getElementById('toolSelect');
      const verktøyListe = [];

      Object.entries(data).forEach(([kategori, items]) => {
        items.forEach(verktøy => {
          verktøyListe.push(verktøy);
          const option = document.createElement('option');
          option.value = verktøy.Model;
          option.textContent = `${verktøy.Model} (${kategori})`;
          select.appendChild(option);
        });
      });

      
      const categorySelect = document.getElementById('categoryFilter');
      const brandSelect = document.getElementById('brandFilter');

      const unikeKategorier = [...new Set(verktøyListe.map(v => v.kategori))];
      unikeKategorier.forEach(kat => {
        const opt = document.createElement('option');
        opt.value = kat;
        opt.textContent = kat;
        categorySelect.appendChild(opt);
      });

      categorySelect.addEventListener('change', () => {
        const valgtKategori = categorySelect.value;
    const valgtMerke = brandSelect.value;
        select.innerHTML = '<option disabled selected>-- Velg et verktøy --</option>';
        verktøyListe.forEach(v => {
          if (valgtKategori === 'alle' || v.kategori === valgtKategori) {
            const option = document.createElement('option');
            option.value = v.Model;
            option.textContent = `${v.Model} (${v.kategori})`;
            select.appendChild(option);
          }
        });
      });

      
      const brandSelect = document.getElementById('brandFilter');

      const unikeMerker = [...new Set(verktøyListe.map(v => v.brand))];
      unikeMerker.forEach(merke => {
        const opt = document.createElement('option');
        opt.value = merke;
        opt.textContent = merke;
        brandSelect.appendChild(opt);
      });

      function oppdaterVerktøyliste() {
        const valgtKategori = categorySelect.value;
    const valgtMerke = brandSelect.value;
        const valgtMerke = brandSelect.value;
        select.innerHTML = '<option disabled selected>-- Velg et verktøy --</option>';
        verktøyListe.forEach(v => {
          if (
            (valgtKategori === 'alle' || v.kategori === valgtKategori) &&
            (valgtMerke === 'alle' || v.brand === valgtMerke)
          ) {
            const option = document.createElement('option');
            option.value = v.Model;
            option.textContent = `${v.Model} (${v.kategori})`;
            select.appendChild(option);
          }
        });
      }

      categorySelect.addEventListener('change', oppdaterVerktøyliste);
      brandSelect.addEventListener('change', oppdaterVerktøyliste);

      select.addEventListener('change', (e) => {
        const valgt = verktøyListe.find(v => v.Model === e.target.value);
        visVerktøy(valgt);
      });
    }

    function vurderTiltak(v, min) {
      if (!v || isNaN(v)) return ['-', ''];
      const t = min / 60;
      const e = (v * Math.sqrt(t)) ** 2;
      if (e < 6.25) return [e.toFixed(2), 'Grønn'];
      else if (e < 25) return [e.toFixed(2), 'Gul'];
      else return [e.toFixed(2), 'Rød'];
    }

    function visVerktøy(v) {
      const info = document.getElementById('toolInfo');
      const vibrasjon = parseFloat((v.Vibrasjon || "0").replace(',', '.'));
      const støy = v.Støy || "-";

      let html = `<h2>${v.Model}</h2>`;
      html += `<img src='bilder/${v.Model}.jpg' class='tool-img' alt='${v.Model}'/>`;
      html += `<p><strong>Kategori:</strong> ${v.kategori}</p>`;
      html += `<p><strong>Vibrasjon:</strong> ${vibrasjon} m/s²</p>`;
      html += `<p><strong>Støy:</strong> ${støy}</p>`;
      html += `<h3>Eksponering og tiltak</h3>`;
      html += `<table class='eksponering-tabell'><thead><tr><th>Minutt</th><th>Eksponering</th><th>Tiltak</th></tr></thead><tbody>`;

      [1,5,10,30,60].forEach(min => {
        const [e, farge] = vurderTiltak(vibrasjon, min);
        html += `<tr class='${farge}'><td>${min}</td><td>${e}</td><td>${farge}</td></tr>`;
      });

      html += `</tbody></table>

<h3>Forklaring på tiltak</h3>
<table class='eksponering-tabell'>
  <thead>
    <tr>
      <th>Nivå</th>
      <th>Eksponeringsverdi</th>
      <th>Betydning</th>
      <th>Eksempler på tiltak</th>
    </tr>
  </thead>
  <tbody>
    <tr class='Grønn'>
      <td>Grønn</td>
      <td>&lt; 6,25</td>
      <td>Ingen tiltak nødvendig</td>
      <td>-</td>
    </tr>
    <tr class='Gul'>
      <td>Gul</td>
      <td>6,25 – 25</td>
      <td>Tiltaksverdi overskredet</td>
      <td>Ta pauser, roter oppgaver, bruk lavvibrasjonsverktøy</td>
    </tr>
    <tr class='Rød'>
      <td>Rød</td>
      <td>&ge; 25</td>
      <td>Grenseverdi overskredet – helserisiko</td>
      <td>Stans arbeid, bytt verktøy, planlegg alternativer</td>
    </tr>
  </tbody>
</table>
`;
      info.innerHTML = html;
    }

    loadTools();
  </script>
</body>
</html>
