<!DOCTYPE html>

<html lang="no">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Bravida Vibrasjonsassistent</title>




</head>
<body>
<img alt="Bravida logo" src="bravida logo-400x119.png" style="max-width: 200px;"/>
<h1>Vibrasjonsassistent</h1>
<label for="brandFilter">Filtrer etter merke:</label>
<select id="brandFilter"><option selected="" value="alle">Alle merker</option></select>

<label for="categoryFilter">Filtrer etter kategori:</label>
<select id="categoryFilter"><option selected="" value="alle">Alle kategorier</option></select>

<label for="toolSelect">Velg verktøy:</label>
<select id="toolSelect"><option disabled="" selected="">-- Velg et verktøy --</option></select>

<div id="toolInfo"></div>
<div class="eksponering-logg" id="eksponeringsLogg"><h3>Dagens eksponering</h3><ul id="loggListe"></ul><p id="loggTotal"></p></div>





<style>
  .eksponering-logg { margin-top: 2rem; padding: 1rem; border: 1px solid #ccc; background: #f1f1f1; }
  .eksponering-logg h3 { margin-top: 0; }
  .eksponering-logg input { width: 60px; margin-right: 10px; }
</style>

<div id="toolInfo"></div>

<div class="eksponering-logg">
  <h3>Totaleksponering</h3>
  <ul id="bruksliste"></ul>
  <p id="totalEksponering">Total eksponering: 0 m/s²²</p>
  <button onclick="nullstillLogg()">Nullstill</button>
</div>

<script>
let valgtVerktøy = null;
let eksponeringslogg = [];

async function loadData() {
  const response = await fetch('data.json');
  const data = await response.json();
  const verktøyListe = [];

  for (const [brand, items] of Object.entries(data)) {
    items.forEach(item => {
      item.brand = brand;
      item.kategori = item.Kategori || 'Ukjent';
      verktøyListe.push(item);
    });
  }

  const kategoriSelect = document.getElementById('categoryFilter');
  const merkeSelect = document.getElementById('brandFilter');
  const toolSelect = document.getElementById('toolSelect');

  const kategorier = [...new Set(verktøyListe.map(t => t.kategori))].sort();
  kategorier.forEach(k => {
    const opt = document.createElement('option');
    opt.value = k;
    opt.textContent = k;
    kategoriSelect.appendChild(opt);
  });

  const merker = [...new Set(verktøyListe.map(t => t.brand))].sort();
  merker.forEach(b => {
    const opt = document.createElement('option');
    opt.value = b;
    opt.textContent = b;
    merkeSelect.appendChild(opt);
  });

  function oppdaterVerktøy() {
    const valgtKategori = kategoriSelect.value;
    const valgtMerke = merkeSelect.value;
    toolSelect.innerHTML = '<option disabled selected>-- Velg et verktøy --</option>';
    verktøyListe.forEach(t => {
      if (
        (valgtKategori === 'alle' || t.kategori === valgtKategori) &&
        (valgtMerke === 'alle' || t.brand === valgtMerke)
      ) {
        const opt = document.createElement('option');
        opt.value = t.Model;
        opt.textContent = `${t.Model} (${t.kategori})`;
        toolSelect.appendChild(opt);
      }
    });
  }

  kategoriSelect.addEventListener('change', oppdaterVerktøy);
  merkeSelect.addEventListener('change', oppdaterVerktøy);

  toolSelect.addEventListener('change', () => {
    valgtVerktøy = verktøyListe.find(t => t.Model === toolSelect.value);
    visStatistikk(valgtVerktøy);
  });
}

function vurderTiltak(v, min) {
  const t = min / 60;
  const e = (v * Math.sqrt(t)) ** 2;
  if (e < 6.25) return [e.toFixed(2), 'Ingen tiltak'];
  else if (e < 25) return [e.toFixed(2), 'Tiltak vurderes'];
  else return [e.toFixed(2), 'Grense overskredet'];
}

function visStatistikk(v) {
  const toolInfo = document.getElementById('toolInfo');
  const vibrasjon = parseFloat((v.Vibrasjon || '0').replace(',', '.'));
  const støy = v.Støy || '-';

  let html = `<h2>${v.Model}</h2>`;
  html += `<p><strong>Kategori:</strong> ${v.kategori}</p>`;
  html += `<p><strong>Merke:</strong> ${v.brand}</p>`;
  html += `<p><strong>Vibrasjon:</strong> ${vibrasjon.toFixed(2)} m/s²</p>`;
  html += `<p><strong>Støy:</strong> ${støy}</p>`;
  html += `<h3>Eksponering ved ulike brukstider</h3>`;
  html += `<table class="eksponering-tabell"><thead><tr><th>Min</th><th>Eksponering</th><th>Tiltak</th><th>Legg til</th></tr></thead><tbody>`;

  [1, 2, 5, 10, 20, 30, 60].forEach(min => {
    const [eks, tiltak] = vurderTiltak(vibrasjon, min);
    html += `<tr><td>${min}</td><td>${eks}</td><td>${tiltak}</td>
      <td><button onclick="leggTilBruk('${v.Model}', ${vibrasjon}, ${min})">+</button></td></tr>`;
  });

  html += "</tbody></table>";
  toolInfo.innerHTML = html;
}

function leggTilBruk(model, vibrasjon, min) {
  const t = min / 60;
  const eksponering = (vibrasjon * Math.sqrt(t)) ** 2;
  eksponeringslogg.push({ model, min, eksponering });
  oppdaterTotal();
}

function oppdaterTotal() {
  const ul = document.getElementById('bruksliste');
  const total = document.getElementById('totalEksponering');
  ul.innerHTML = '';
  let sum = 0;
  eksponeringslogg.forEach(e => {
    const li = document.createElement('li');
    li.textContent = `${e.model} – ${e.min} min = ${e.eksponering.toFixed(2)} m/s²²`;
    sum += e.eksponering;
    ul.appendChild(li);
  });
  const status = sum < 6.25 ? "✅ Lav total" :
                 sum < 25 ? "⚠️ Nær grense" :
                 "❌ Grense overskredet";
  total.textContent = `Total eksponering: ${sum.toFixed(2)} m/s²² – ${status}`;
}

function nullstillLogg() {
  eksponeringslogg = [];
  oppdaterTotal();
}

loadData();
</script>

</body>
</html>