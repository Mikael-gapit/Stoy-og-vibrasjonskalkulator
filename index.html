<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bravida Vibrasjonsassistent</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 1rem; }
    .tool-img { max-height: 150px; margin-top: 1rem; }
    .eksponering-tabell td, .eksponering-tabell th { padding: 6px; border: 1px solid #ccc; text-align: center; }
    .Grønn { background-color: #d4edda; }
    .Gul { background-color: #fff3cd; }
    .Rød { background-color: #f8d7da; }
  </style>
</head>
<body>
  <img src="bravida logo-400x119.png" alt="Bravida logo" style="max-width: 200px;"/>
  <h1>Vibrasjonsassistent</h1>

  <label for="toolSelect">Velg verktøy:</label>
  <select id="toolSelect">
    <option disabled selected>-- Velg et verktøy --</option>
  </select>

  <div id="toolInfo"></div>

  <script>
    async function loadTools() {
      const response = await fetch('data.json');
      const data = await response.json();
      const select = document.getElementById('toolSelect');
      const verktøyListe = [];

      Object.entries(data).forEach(([kategori, items]) => {
        items.forEach(verktøy => {
          verktøy.kategori = kategori;
          verktøyListe.push(verktøy);
          const option = document.createElement('option');
          option.value = verktøy.Model;
          option.textContent = `${verktøy.Model} (${kategori})`;
          select.appendChild(option);
        });
      });

      select.addEventListener('change', (e) => {
        const valgt = verktøyListe.find(v => v.Model === e.target.value);
        visVerktøy(valgt);
      });
    }

    function vurderTiltak(v, min) {
      if (!v || isNaN(v)) return ['-', ''];
      const t = min / 60;
      const e = (v * Math.sqrt(t)) ** 2;
      if (e < 6.25) return [e.toFixed(2), 'Grønn'];
      else if (e < 25) return [e.toFixed(2), 'Gul'];
      else return [e.toFixed(2), 'Rød'];
    }

    function visVerktøy(v) {
      const info = document.getElementById('toolInfo');
      const vibrasjon = parseFloat((v.Vibrasjon || "0").replace(',', '.'));
      const støy = v.Støy || "-";

      let html = `<h2>${v.Model}</h2>`;
      html += `<img src='bilder/${v.Model}.jpg' class='tool-img' alt='${v.Model}'/>`;
      html += `<p><strong>Kategori:</strong> ${v.kategori}</p>`;
      html += `<p><strong>Vibrasjon:</strong> ${vibrasjon} m/s²</p>`;
      html += `<p><strong>Støy:</strong> ${støy}</p>`;
      html += `<h3>Eksponering og tiltak</h3>`;
      html += `<table class='eksponering-tabell'><thead><tr><th>Minutt</th><th>Eksponering</th><th>Tiltak</th></tr></thead><tbody>`;

      [1,5,10,30,60].forEach(min => {
        const [e, farge] = vurderTiltak(vibrasjon, min);
        html += `<tr class='${farge}'><td>${min}</td><td>${e}</td><td>${farge}</td></tr>`;
      });

      html += `</tbody></table>`;
      info.innerHTML = html;
    }

    loadTools();
  </script>
</body>
</html>