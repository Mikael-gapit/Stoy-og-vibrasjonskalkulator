<!DOCTYPE html>
<html lang="no" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Støy og Vibrasjonsassistent</title>
  <script>
    tailwind.config = {
      darkMode: 'class',
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png">
  <style>
    .dark-mode-transition {
      transition: background-color .3s, color .3s;
    }
  </style>
</head>
<body class="dark-mode-transition bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 p-4">
  <div class="max-w-xl mx-auto">
    <header class="flex items-center justify-between mb-6">
      <img src="bravida logo-400x119.png" alt="Bravida Logo" class="h-12">
      <button id="darkToggle" aria-label="Toggle dark mode" class="p-2 bg-gray-200 dark:bg-gray-600 rounded">
        <svg id="iconLight" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500 hidden" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10 3.22l.61.61a1 1 0 01-.61.17A1 1 0 109.39 3.83L10 3.22z"/>
        </svg>
        <svg id="iconDark" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-800 dark:text-gray-200" fill="currentColor" viewBox="0 0 20 20">
          <path d="M17.293 13.293A8 8 0 116.707 2.707a8 8 0 0010.586 10.586z"/>
        </svg>
      </button>
    </header>
    <section class="space-y-4">
      <div>
        <label for="brand" class="font-medium">Merke</label>
        <select id="brand" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600">
          <option value="">Velg merke…</option>
        </select>
      </div>
      <div>
        <label for="model" class="font-medium">Modell</label>
        <select id="model" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600">
          <option value="">Velg modell…</option>
        </select>
      </div>
      <div>
        <label for="usage" class="font-medium">Brukstid (min)</label>
        <input id="usage" type="number" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600" placeholder="30" />
      </div>
      <button id="calcBtn" class="w-full p-3 bg-blue-600 text-white rounded">Beregn</button>
    </section>
    <section id="resultSection" class="mt-6 space-y-4"></section>
  </div>

<script>
// Inline data
const data = {"Milwaukee": [{"Model": "M18 FDDS", "Støy": "106,78 dB", "Vibrasjon": "1,85 m/s2"}, {"Model": "M18 FBS85", "Støy": "93,63 dB", "Vibrasjon": "1,5 m/s2"}, {"Model": "M18 CAG125XPDB", "Støy": "93,6 dB", "Vibrasjon": "4,79 m/s2"}, {"Model": "M18 FMS254", "Støy": "101,5 dB", "Vibrasjon": ""}, {"Model": "M18 FH-OX", "Støy": "103,6 dB", "Vibrasjon": "17 m/s2"}, {"Model": "M18 FMTIW2F12-502X", "Støy": "106,4 dB", "Vibrasjon": "17,4 m/s2"}, {"Model": "M18 FMTIW2P12-50X", "Støy": "106,4 dB", "Vibrasjon": "17,3 m/s2"}, {"Model": "M18 FQID", "Støy": "98,9 dB", "Vibrasjon": "19,4 m/s2"}, {"Model": "M18 FHZ", "Støy": "95,7 dB", "Vibrasjon": "8,3 m/s2"}, {"Model": "M18 FMCS-0X", "Støy": "109,1 dB", "Vibrasjon": "2,37 m/s2"}, {"Model": "M18 ONEFHXDEL-552C", "Støy": "103,6 dB", "Vibrasjon": "14,2 m/s2"}, {"Model": "M18 CBLPD", "Støy": "104,8 dB", "Vibrasjon": "12,4 m/s2"}, {"Model": "C12 MT-402B", "Støy": "86,5 dB", "Vibrasjon": "8,7 m/s2"}, {"Model": "M12 FIWF12-422X", "Støy": "107,82 dB", "Vibrasjon": "17,24 m/s2"}, {"Model": "M12 BD", "Støy": "96 dB", "Vibrasjon": "1,5 m/s2"}, {"Model": "M12 FDD2-602X", "Støy": "85,8 dB", "Vibrasjon": "1,92 m/s2"}], "Hilti": [{"Model": "TE-50-AVR", "Støy": "108 dB", "Vibrasjon": "9 m/s2"}, {"Model": "Te30-a36", "Støy": "99 dB", "Vibrasjon": "10,6 m/s2"}, {"Model": "TE 6-A22 DRS", "Støy": "100 dB", "Vibrasjon": "13,4 m/s2"}], "Panasonic": [{"Model": "EY78A1", "Støy": "95 dB", "Vibrasjon": "11 m/s2"}]};

// DOM elements
const brandEl = document.getElementById('brand');
const modelEl = document.getElementById('model');
const usageEl = document.getElementById('usage');
const calcBtn = document.getElementById('calcBtn');
const resultSec = document.getElementById('resultSection');
const darkBtn = document.getElementById('darkToggle');
const iconLight = document.getElementById('iconLight');
const iconDark = document.getElementById('iconDark');

// Populate brands
function populateBrands() {
  Object.keys(data).forEach(b => {
    const opt = document.createElement('option');
    opt.value = b; opt.textContent = b;
    brandEl.append(opt);
  });
}
brandEl.addEventListener('change', () => {
  modelEl.innerHTML = '<option value="">Velg modell…</option>';
  (data[brandEl.value]||[]).forEach(item => {
    const opt = document.createElement('option');
    opt.value = item.Model; opt.textContent = item.Model;
    modelEl.append(opt);
  });
  resultSec.innerHTML = '';
});

// Calculate and show visual feedback
calcBtn.addEventListener('click', () => {
  const brand = brandEl.value;
  const model = modelEl.value;
  const usage = parseFloat(usageEl.value);
  resultSec.innerHTML = '';
  if(!brand || !model || isNaN(usage)) {
    resultSec.innerHTML = '<p class="text-red-600">Fyll ut alle feltene.</p>';
    return;
  }
  const tool = data[brand].find(t => t.Model === model);
  const noiseVal = parseFloat(tool.Støy.replace(',', '.')) || 0;
  const vibVal = parseFloat(tool.Vibrasjon.replace(',', '.')) || 0;
  const noisePercent = Math.min((noiseVal/85)*100, 100);
  const vibPercent = Math.min((vibVal/10)*100, 100);

  // Colors
  const noiseColor = noiseVal > 85 ? 'bg-red-600' : (noiseVal > 75 ? 'bg-yellow-500' : 'bg-green-500');
  const vibColor = vibVal > 10 ? 'bg-red-600' : (vibVal > 7 ? 'bg-yellow-500' : 'bg-green-500');

  // Display
  resultSec.innerHTML = `
    <h2 class="text-xl font-semibold">Resultat</h2>
    <p><strong>Merke:</strong> ${brand}</p>
    <p><strong>Modell:</strong> ${model}</p>
    <div>
      <p><strong>Støy (${noiseVal} dB):</strong></p>
      <div class="w-full bg-gray-200 h-4 rounded">
        <div class="${noiseColor} h-4 rounded" style="width:${noisePercent}%"></div>
      </div>
    </div>
    <div>
      <p><strong>Vibrasjon (${vibVal} m/s²):</strong></p>
      <div class="w-full bg-gray-200 h-4 rounded">
        <div class="${vibColor} h-4 rounded" style="width:${vibPercent}%"></div>
      </div>
    </div>
    <p><strong>Brukstid:</strong> ${usage} min</p>
    ${(noiseVal>85 || vibVal>10) ? 
      '<div class="mt-4 p-4 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 rounded animate-pulse"><strong>⚠️ Advarsel:</strong> Høy eksponering – bruk verneutstyr og ta pauser.</div>' 
      : ''}
  `;
});

// Dark mode toggle
darkBtn.addEventListener('click', () => {
  document.documentElement.classList.toggle('dark');
  iconLight.classList.toggle('hidden');
  iconDark.classList.toggle('hidden');
});

// Init
window.addEventListener('load', () => {
  populateBrands();
});
</script>
</body>
</html>