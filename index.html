
<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bravida Vibrasjonsassistent</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; color: #222; max-width: 800px; margin: auto; padding: 1rem; }
    h2, h3 { color: #004077; }
    select, button { padding: 6px; font-size: 1rem; margin: 4px 0; border-radius: 4px; border: 1px solid #aaa; }
    button { background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .eksponering-tabell { width: 100%; border-collapse: collapse; margin-top: 1rem; background: white; }
    .eksponering-tabell th, .eksponering-tabell td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    .eksponering-tabell th { background: #007bff; color: white; }
    .eksponering-tabell tr:nth-child(even) { background: #f0f8ff; }
    .tool-img { max-height: 150px; margin-top: 1rem; }
    .Grønn { background-color: #d4edda; }
    .Gul { background-color: #fff3cd; }
    .Rød { background-color: #f8d7da; }
  </style>
</head>
<body>
  <img src="bravida logo-400x119.png" alt="Bravida logo" style="max-width: 200px;"/>
  <h1>Vibrasjonsassistent</h1>

  <label for="brandFilter">Filtrer etter merke:</label>
  <select id="brandFilter"><option value="alle" selected>Alle merker</option></select>

  <label for="categoryFilter">Filtrer etter kategori:</label>
  <select id="categoryFilter"><option value="alle" selected>Alle kategorier</option></select>

  <label for="toolSelect">Velg verktøy:</label>
  <select id="toolSelect"><option disabled selected>-- Velg et verktøy --</option></select>

  <div id="toolInfo"></div>

  <script>
    async function loadTools() {
      const response = await fetch('./data.json');
      const data = await response.json();
      const verktøyListe = Object.values(data).flat();
      const select = document.getElementById('toolSelect');
      const brandSelect = document.getElementById('brandFilter');
      const categorySelect = document.getElementById('categoryFilter');

      const unikeMerker = [...new Set(verktøyListe.map(v => v.brand))];
      unikeMerker.forEach(merke => {
        const opt = document.createElement('option');
        opt.value = merke;
        opt.textContent = merke;
        brandSelect.appendChild(opt);
      });

      const unikeKategorier = [...new Set(verktøyListe.map(v => v.Kategori))];
      unikeKategorier.forEach(kat => {
        const opt = document.createElement('option');
        opt.value = kat;
        opt.textContent = kat;
        categorySelect.appendChild(opt);
      });

      function oppdaterVerktøyliste() {
        const valgtMerke = brandSelect.value;
        const valgtKategori = categorySelect.value;
        select.innerHTML = '<option disabled selected>-- Velg et verktøy --</option>';
        verktøyListe.forEach(v => {
          if ((valgtMerke === 'alle' || v.brand === valgtMerke) && (valgtKategori === 'alle' || v.Kategori === valgtKategori)) {
            const option = document.createElement('option');
            option.value = v.Model;
            option.textContent = `${v.Model} (${v.Kategori})`;
            select.appendChild(option);
          }
        });
      }

      brandSelect.addEventListener('change', oppdaterVerktøyliste);
      categorySelect.addEventListener('change', oppdaterVerktøyliste);

      select.addEventListener('change', (e) => {
        const valgt = verktøyListe.find(v => v.Model === e.target.value);
        visVerktøy(valgt);
      });
    }

    function vurderTiltak(v, min) {
      if (!v || isNaN(v)) return ['-', ''];
      const t = min / 60;
      const e = (v * Math.sqrt(t)) ** 2;
      if (e < 6.25) return [e.toFixed(2), 'Grønn'];
      else if (e < 25) return [e.toFixed(2), 'Gul'];
      else return [e.toFixed(2), 'Rød'];
    }

    function visVerktøy(v) {
      const info = document.getElementById('toolInfo');
      const vibrasjon = parseFloat((v.Vibrasjon || "0").replace(',', '.'));
      const støy = v.Støy || "-";

      let html = `<h2>${v.Model}</h2>`;
      html += `<img src='bilder/${v.Model}.jpg' class='tool-img' alt='${v.Model}'/>`;
      html += `<p><strong>Kategori:</strong> ${v.Kategori}</p>`;
      html += `<p><strong>Merke:</strong> ${v.brand}</p>`;
      html += `<p><strong>Vibrasjon:</strong> ${vibrasjon} m/s²</p>`;
      html += `<p><strong>Støy:</strong> ${støy}</p>`;
      html += `<h3>Eksponering og tiltak</h3>`;
      html += `<table class='eksponering-tabell'><thead><tr><th>Minutt</th><th>Eksponering</th><th>Tiltak</th></tr></thead><tbody>`;

      [1,5,10,30,60].forEach(min => {
        const [e, farge] = vurderTiltak(vibrasjon, min);
        html += `<tr class='${farge}'><td>${min}</td><td>${e}</td><td>${farge}</td></tr>`;
      });

      html += `</tbody></table>`;
      info.innerHTML = html;
    }

    loadTools();
  </script>
</body>
</html>
